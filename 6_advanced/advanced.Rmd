---
title: "Advanced Text Analysis and Extensions"
author: "Kenneth Benoit and Paul Nulty"
date: "18 October 2015"
output: html_document
---

In this section we will explore some text analysis and analysis of metadata from a corpus of tweets retrieved from the Twitter API. The tweets are a small sample from a collection of tweets relating to the European Parliament elections of 2015.

Load the data frame containing the sample tweets:

```{r}
setwd("~/Dropbox/QUANTESS/courses/ITAUR/ITAUR_paul_github/")
load(file = 'data/tweetSample.RData')
```


```{r}
require(lubridate)
tweetSample <- mutate(tweetSample, day = yday(created_at))
tweetSample <- mutate(tweetSample, dayDate = as.Date(day-1, origin = "2014-01-01"))
juncker <- filter(tweetSample, grepl('juncker', text, ignore.case=TRUE)) %>% mutate(kand='Juncker')
schulz <- filter(tweetSample, grepl('schulz', text, ignore.case=TRUE))  %>% mutate(kand='Schulz')
verhof <- filter(tweetSample, grepl('verhofstadt', text, ignore.case=TRUE)) %>% mutate(kand='Verhofstadt')
tsipras <- filter(tweetSample, grepl('tsipras', text, ignore.case=TRUE)) %>% mutate(kand='Tsipras')
spitzAll <- bind_rows(juncker, schulz, verhof)
bg <- count(spitzAll, day=day)

```

Once the data is in the correct format, we can use ggplot to display the candidate mentions on the a single plot:

```{r}
require(ggplot2)
require(scales)
# mentioning kandidates names over time
plotDf <- count(spitzAll, kand, day=day)  %>% mutate(day=as.Date(day-1, origin = "2014-01-01"))
plotDf$bg <- rep(bg$n, 3)
ggplot(data=plotDf, aes(x=day, y=n, colour=kand)) + 
    geom_line(size=1) +
    scale_y_continuous(labels = comma) + geom_vline(xintercept=as.numeric(as.Date("2014-05-15")), linetype=4) +
    geom_vline(xintercept=as.numeric(as.Date("2014-05-25")), linetype=4) +
    theme(axis.text=element_text(size=12),
          axis.title=element_text(size=14,face="bold"))

```


We can use the keptFeatures argument to dfm to analyse only hashtags for each candidate's text.
```{r}

# Top hashtags for tweets that mention Juncker

dv <- data.frame(user=juncker$user_screen_name)
jCorp <- corpus(juncker$text, docvars=dv)
jd <- dfm(jCorp,keptFeatures = "^#*") 
topfeatures(jd, 10)

```
